#  admin_default网际互连

---

## 设备介绍

### 交换机（多功能网桥）

```
多个冲突域，一个广播域，每个端口都是冲突域
```

### 路由器

```
隔离广播域和冲突域，每个端口都是广播域
功能：
数据包的转发
数据包过滤
网络之间的通信
路径选择
```

### 一个LAN中通信量阻塞

```
在一个广播域中有太多的主机
广播风暴
组播
低带宽
为连接到的网络中添加了集线器
大量的ARP或者IPX流量
```

### 集线器的作用

```
将不同网段连接在一起
但是！！！不进行网段的划分
```

## 网络层次结构

| 功能       | 层次结构                               |
| ---------- | -------------------------------------- |
| 物理层     | 发送和接收比特流                       |
| 数据链路层 | 组帧                                   |
| 网络层     | 路由选择、分组转发                     |
| 传输层     | 端到端的服务：流量控制，面向连接的通信 |
| 应用层     | 实际应用程序的接口                     |
| 表示层     | 数据的转换和代码的格式化               |
| 会话层     | 建立管理终止实体会话连接               |

面向连接：

```
建立了一条虚电路
使用了排序
使用了确认
使用了流量控制
```

### CSMA/CD

所有在同一条链路上的主机都会使用同一条连路上的带宽，我们使用载波侦听多路访问/冲突检测技术来平均分配带宽，原理如下：

```
当一台主机像发送数据的时候，先查看当前线路上是否有其他主机的信息在线路上传递，如果没有就直接发送数据信息，边发送边监听，保证线路上没有其他主机发送数据，若有用户发送数据，则通过lam信号提醒它暂停，并且等待一段时间再检测线路，这里使用到了退避算法。
```

### 半双工以太网

为了避免冲突，也使用CSMA/CD

半双工以太网共享一个冲突域 ,它所提供 的有效吞吐量 比全双工以太网低 一些。

典型情况下,全双工以太网有专用的冲突域 ,有效的吞吐量也高一些

### 隧道技术

将一个帧封装到不同类的帧中

### 数据帧

![1597221087822](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597221087822.png)

note：

```
⒒hemet帧与我们在IPxˉd路由协议中使用的 Ethernet~Ⅱ 帧是一样的 ,但是当帧携带IPv6数据时,类型字段为0x86dd,而当携带 Pv4数据时,协议字段则为 0x0800:
```

物理层以太网

| 委员会      | 传输速率            |
| ----------- | ------------------- |
| IEEE802.3   | 10Mb/s              |
| IEEE802.3ab | 5类线上的高速以太网 |
| IEEE802.3ae | 10Gb/s              |

### 电缆连接

```
直通电缆：
主机--交换机
主机--集线器
路由器--交换机
路由器--集线器

交叉电缆：
集线器--交换机
路由器--主机
交换机--交换机
集线器--集线器
主机--主机
```

### 数据封装

![1597225146009](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597225146009.png)

封装的过程

````
1.用户信息转换为数据 ,以便在网络上传输 。
2.数 据转换 为数据段 ,并在发送方和接收方主机之间建立一条可靠的连接 。 
3,数 据段转换 为数据包或数据报 ,并在报头中放上逻辑地址 ,这样 ,每一个数据包都可以通过互联网络进行传输 。 4,数据包或数据报转换为帧 ,以便在本地 网络 中传输 。在本地网段上 ,使用硬件 (以 太 网)地 址唯一标识每一 台主机 。
5.帧 转换为 比特流 ,并采用数字编码和时钟方案 。 
````

![1597226444379](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597226444379.png)

### 三层模型

核心层 :骨干 

分 配层 :路由 

接 入层 :交换

核心层

```
不要左任何影响通信流量的事，包括访问列表、路由选择、包过滤
不要在这里支持工作组接入
不要扩充要升级
要求:
高可靠性、高速率、低冗余、低延迟、收敛快
```

分配层

```
操作：
路由
工具的实现：访问表、包过滤、排序
网络安全和网络策略的实现
重新分配路由协议，包括静态路由
在vla之间进行路由，支持工作组
定义广播域和组播域
```

接入层

```
连续的访问控制和策略
创建隔离的从冲突域
到分配层的工作组连通性
```

![1597284752154](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597284752154.png)

# TCP/IP

----



### 层次结构

```
·过程/应 用层 

·主机到主机层 

·因特 网层 

·网络接人层
```

### 功能：

```
应用层定义结点到结点的应用通信协议以及对用户界面规范的控制 。 
主机到主机层：要解决了如何创建可靠 的端到端 的通信 ,并确保对数据传 送是无差错的c它 保证 了数据包的顺序传送及数据的完整性 
英特网层：过赋予主机一个 IP(因特网协议)地址来完成对主机的寻址 ,它还负责数据包在多种网络中的路由。 
网络接入层：它负责监视数据在主机和网络之问的交换 。
```

![1597285520758](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597285520758.png)

## 应用层协议

### FTP文件传输协议

```
任意两台主机之间的传输
缺点：即使 FTP可以被用户以应用程序的方式来使用,FTP的功能也只限于列表和目录操作、文件内容输入,以及在主机间进行文件拷贝。它不能远程执行程序文件 
```

### TFTP简单文件传输协议

```
只能完成文件的发送和接收，不提供目录的浏览功能，如果要获取传输文件的文件名和文件的具体位置的时候可以使用它
```

### NFS网络文件系统

```
它允许两个不同类型的文件系统实现互操作
```

### SMTP简单的邮件传输系统

```
SMTP用来发送邮件,POP3用来接收邮件 
```

### SNMP 简单的网路管理协议

```
采集有用的网络信息，通告给网络管理员任何突发事件的产生，这些网络看门狗被称为代理 .并Ⅱ~肖一个故障发生时,这些代理会发 送一个称为陷阱的警告给管理站
```

### DNS域名服务

```
DNS允许你使用域名来指定某个IP地址。这样,就可以在需要时经常变更ip地址
```

## 传输层协议

### TCP传输控制协议

```
面向连接：虚电路、全双工、可靠连接
```

![1597288044493](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597288044493.png)

### UDP用户数据包协议

```
无连接、不可靠、高速率、数据无序
```

![1597288608530](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597288608530.png)

### TCP/UDP比较：

![1597288666165](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597288666165.png)

![1597289749717](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597289749717.png)

## 因特网层协议

### 因特网协议 (IP) 

IP是 从主机到主机层接收数据段 的,必要时再将它们分成数据报 (即 数据包)。 然后 , 接收方的 IP再 重新组合数据报为数据段 。每个数据报都被指定了发送者和接收者的 IP地 址 。每个接收了数据报 的路由器 (第 3层 设 备 )都 是基 于数据包 的 目的 IP地 址来决定路 由的

![1597297658589](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597297658589.png)

### ·因特网控制报文协议 (ICMP) 

 是一个管理性协议 ,并 且也是一个 IP信 息服务 的提供者 。它 的信息是被作为 IP数 据报来 传送的。

### ·地址解析协议 (ARP) 

ARP会 通过发送 出一 个广播数据包来询 问本地 的网络 ,要求使用这 一指定 IP地 址 的计算机应答其自身的硬件地址 。因此 ,可以说 ARP能 够实现软件 (1P)地 址到硬件地址 (如 目的计算机 的以太 网板卡地址 )的 转换 ,并 臣能够通过广播判断 出它在局 域网上 的位置 。图 2.10显 示 了 ARP是 如何查寻一个本地 网络的

![1597298876578](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597298876578.png)

·逆 向地址解析协议(RARP) 

逆 向地 址 解 析协议 (RARP)町 以通 过 发送 一 个包 含 有无盘主机 MAC地 址 的数据包来发现 该 IP地 址 的身份 ,并 询 问 与此 MAC地 址 相对 应 的 IP地 址 。网络上会指定一个被称为 RARP服务器的计算机来 响应 这个 请求 ,这 样 .无 盘 主 机就会得到 自己的 IP地 址 

![1597298997791](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597298997791.png)

### 代理 ARP

网络上不允许 主机配置多个默认 网关 。那 么来考虑一 下 ,如 果某个 默认 网关 (路 由器 ) 因故 障而停机 ,会 怎么样 呢?这 时 ,该 主机就不 能再 向其他 的路 由器发送 数据 ,你 需要 重新 配置这 台主机 。而代理 ARP则 可 以在 这种 情 况下 白动帮助那 些 在某 个 子 网中的主机 ,在 不重新配置路 由甚 至默认 网关 的情况下 ,发 送数据到远程子 网

## IP寻址

### 广播地址

 被 应 用 程 序 和 主 机 用 来 将 信 息 发 送 给 网 络 上 所 有 结 点 的 地 址 ,我 们 称 之 为广 播 地 址 。 例 如 ,255.255.255.255用 于 指 向 所 有 网 络 ,所 有 结 点 ;172.16.255.255,指 向 网络 172.16.0.0上 的 所 有 子 网 和 主 机 ;而 10.255,255.255,指 向 网 络 10.0.0.0上 的 所 有 子网 和 主 机 。

### 地址分类

| A类地址 | 0-127   |
| ------- | ------- |
| B类地址 | 128-191 |
| C类地址 | 192-223 |
| D类地址 | 224-239 |
| E类地址 | 240-155 |

### 特殊地址

#### 环回地址

127.0.0.1

IP地 址 127.0,0.1通 常用于在单个节`点上测试 IP栈 的配置 ,它 不能被 当做 有效 的主机地址进行使用

主机位全0/1

#### A类地址

```
网络地址个数计算：
一个字节8个位
第一个位被保留，剩余7位寻址pow(2,7)=128
全0保留位默认地址，全1用于诊断，所以剩余128-2=126个网络地址
主机地址个数计算：
pow(2,24)-2个有效主机
```

#### B类地址

```
网络地址计算：
2个字节16位
网络地址必须以1开头然后是0 所以16-2=14 pow(2,14)有效网络
主机地址的个数计算：
pow(2,16)-2
```

#### C类地址

```
网络地址的个数：
3字节24位
网络的前三位必须是110开头，所以24-3=21 pow(2,21)

主机个数的计算：
pow（2，8）-2
```

#### 私有地址

| 地址 | 被保留的地址空间              |
| ---- | ----------------------------- |
| A类  | 10.0.0.0到10.255.255.255      |
| B类  | 172.16.0.0 到172.31.255.255   |
| C类  | 192.168.0.0 到192.168.255.255 |



### 组播

它 允许存在多个接收者来接收信息 ,但又不将信息泛发给广播域 屮的所有主机 ，通过将信息或数据发送给 IP组 播组地址来实现 ，组 播 地 址 起 始 于 224.0.0.0并 终 止 于 239,255.255.255。 

#  子网划分 、变长子网掩码 (ⅤLsM)、TCP/IP排错

## C类子网的划分

```
·这个被选用的子网掩码会产生多少个子网? 
·每个子网中又会有多少个合法的主机号可用? 
·这些合法的子网号是什么? 
·每个子网的广播地址是什么? 
·在每个子网中,哪些是合法的主机号? 
```

实践举例 #C:255.255.255.224/27

对网络192.168.10.0进行划分

子网数量：224--11100000  pow（2，3）8个子网

主机数量：pow(2,8-3)-2=30个主机

合法子网：256-224=32 增量为32：

![1597461103680](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597461103680.png)

```
IP地址的子网和广播地址
192.168.10.17=结点地址
255.255.255.252=子网掩码 这个IP地址的子网和广播地址是什么?256-252=4。 0,4,8,12,16,⒛ ,等等。已经 找到了!主 机地址是介于子网 16和 ⒛ 之间的。这个子网是 192.168.10.16,并 且广播地 址是 19。 合法的主机号是 17和 18
```

## B类子网划分

#B：172.16.192.0/18

网络地址：172.16.0.0

子网掩码：255.255.192.0

子网数：pow（2，2）=4个

主机数：pow（2，16-2）-2个

合法子网号：256-192=64（增量）

| 子网号       | 0.0    | 64.0    | 128.0   | 192.0   |
| ------------ | ------ | ------- | ------- | ------- |
| 第一个主机   | 0.1    | 64.1    | 128.1   | 192.1   |
| 最后一个主机 | 63.254 | 127.254 | 191.254 | 255.254 |
| 广播地址     | 63.255 | 127.255 | 191.255 | 255.255 |

B类地址中某个主机的子网和广播地址：

```
172.16.88.255/20：
20--240   256-240=16（增量）
0  16  32  48  64  80 96 然后88位于80和96之间所以子网为：172.16.80.0
广播地址为该子网的最后一个主机地址的下一位：172.16.95.255
```

## A类子网划分

#A类网络：255.255.255.192/26

子网数：pow(2,26-8)

主机数：pow(2,32-26)-2

第二个八位和第三个八位的增量都为1，第四个八位的增量为256-192=64

前四个子网：

| 子网号       | 10.0.0.0  | 10.0.0.64  | 10.0.0.128 | 10.0.0.192 |
| ------------ | --------- | ---------- | ---------- | ---------- |
| 第一个主机   | 10.0.0.1  | 10.0.0.65  | 10.0.0.129 | 10.0.0.193 |
| 最后一个主机 | 10.0.0.62 | 10.0.0.126 | 10.0.0.190 | 10.0.0.254 |
| 广播地址     | 10.0.0.63 | 10.0.0.127 | 10.0.0.191 | 10.0.0.255 |

最后四个子网：

| 子网号       | 10.255.255.0  | 10.255.255.64  | 10.255.255.128 | 10.255.255.192 |
| ------------ | ------------- | -------------- | -------------- | -------------- |
| 第一个主机   | 10.255.255.1  | 10.255.255.65  |                |                |
| 最后一个主机 | 10.255.255.62 | 10.255.255.126 | 10.255.255.190 | 10.255.255.254 |
| 广播地址     | 10.255.255.3  | 10.255.255.127 | 10.255.255.191 | 10.255.255.255 |

A类子网划分10.1.3.65/23

第三个八位组254   256-254=2，所以第三个八位组0，2，4，6，8……。3.65的子网的下一个子网是.4,所以广播地址为3.255，合法的主机范围是：10.1.2.1--10.1.3.254

问题 :某台路由器在其接 口上接收到一个 目标地址为 172.16.46.191/26的 数据包 。对 这个数据包路由器将做些什么? 

```
回答 :丢弃它。知道为什么吗?172,16,46.191/26的 掩码是 255.255.255.192,它 给出 的分块大小为 64。 这样得到的子网为 0、64、128、192。 191是 128子 网的广播地址 ,而对于 路由器 ,在默认时是要丢弃任何一个广播数据包的
```

## VLSM

![1597632905897](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597632905897.png)

## TCP/IP地址排错

cisco排错步骤：

```
打开dos窗口ping 127.0.0.1 诊断，如果ping成功，则ip栈被初始过，如果失败，则需要重新安装TCP/IP

打开dos窗口ping 本地主机的ip地址如果成功，则说明你的网络接口卡（NIC）是功能正常的，如果失败，则表明NIC卡存在问题，这一步并不能说明网线已经连接到NIC上了，只能说明主机上的ip栈可以与这个NIC通信

ping 网关（路由器），如果正常，表明NIC已经连接到网络并且可以与本地的网络进行通信，如果失败，则表明存在一个本地物理网络问题，这个问题可能出现在NIC到路由器之间的任何一个位置上

ping远端服务器，如果正常，则表明本体主机与 远端服务器之间能进行ip通信，同时确定远端物理网络也是正常的。如果ping 远端服务器失败 ,那么你所面对的将是某些远程物理网络的问题,这时,你需要赶到服务器 的那边,并执行步骤l~步骤3的测试,直到找出症结所在。 
```

使用icmp回应请求和大幅测试网络节点的ip栈是否初始化

traceroute 过使用 TTI'的 超时机制和 ICMP的 出错信息的通报机制 ,显示通往 目 标网络路径上的路由器列表。这个命令将不能在 DOs提 示符下使用 

tracert 和traceroute一样用于windows

arp -a  Windows PC机 上 显 示 IP到 MAC地 址 的 映 射 

show ip arp   显示cisco连路由器上的arp表

ipconfig /all  显示pc机上的网络配置

## IP寻址问题

推断出合法的子网、广播地址和合法的主机范围

note：

```
路由器和服务器上面必须配置合法的主机地址，特别需要检查路由器和服务器上面配置了广播地址的错误。

为路由器分配第一个 可用 的地址 ,给服务器分配最后一个合法 的主机ID
默认网关地址：路由器的ip地址
```

![1597644914682](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597644914682.png)

# cisco的互联网络操作系统(IOs)和安全设备管理器 (SDM)

![1597646156525](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597646156525.png)

## cisco路由器IOS

```
Gsco的 IOS是：
一个可以提供路由、交换、网络互连以及远程通信功能的专有内核
负责完成的工作：
·加载网络协议和功能 
·在设各间连接高速流量 
·在控制访问中添加安全性,防止未授权的网络使用 
·为简化网络的增长和冗余备份提供可缩放性·为连接到网络中的资源提供 网络的可靠性 
```

## 配置 Cisco路由器

![1597648845339](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597648845339.png)

pc连接到路由器：

```
通过控制台端口进行连接
通过辅助端口连接到cisco路由器
in-band
```

特权模式进入配置模式：

```
enable
disable
logout退出控制台
```

进入全局模式

```
config
```

在路 由器 上将配置信息加载到 RAM中 的命令

```
configure terminal (常用) configue memory configure network
```

配置rip

```
Router(config)#router rip
Router(config-router)#version 2
```

显示最近输入过的10条命令

```
show history
```

显示终端配置和命令历史的缓存空间大小

```
show terminal
```

特权模式下修改缓存空间的大小

````
Router#terminal history size 250
````

获取路由器版本

```
show version
```

检查端口

```
show interfaces
show ip interface brief
```

修改主机名

```
Router(config)#hostname caoxuejie
```

标志区

标志区是一个极为有趣的设置 ,使用标志区的优点之一 ,就是给某些或所有敢试图远程 登录或拨号到你 的互联 网络 中的用户提供少许安全警示 

```
banner ?
banner motd//日期信息标 志 区 (MOTD)是 最被 广 泛应用 的标 志 区。它对 每个拨 号进 入 或者 通 过 Telnet、辅助端 口,甚至通 过控 制 台端 口连接 到路 由器 的操 作者 也会 给 出一个 信 息 
```

设置口令

```  
router(config)#enable secret 12345  //加密口令
router(config)#enable password 12345  //启用口令

为辅助端口设置用户模式口令
router(config)#line aux 0
router(config-line)#password aux
router(config-line)#login

设置控制台用户模式的口令
router(config)#line console 0
router(config-line)#password console
router(config-line)#login

设置默认控制台的超时状态绝不超时
router(config)#line console 0
router(config-line)#exec-timeout 0 0
router(config-line)#logging synchronous

telnet口令
router(config)#line vtp 0 4
router(config)#password telnet
router(config)#login


建立无口令验证的telnet
router(config-line)#line vtp 0 4 
router(config-line)#no login
```

## SSH

要替代 Telnet,可 以使用安全外壳 ,与使用不加密数据流的 Telnet应 用相 比,sSH可 以 创建一个更加安全 的会话 。安全外壳 (SSH)使 用加密密钥发送数据 ,这样你 的用户名和 口 令就不再会 以明文 的形式被发送出去 

配置步骤：

```
1.修改用户名
router(config)#hostname todd
设置域名
todd(config)#ip domian-name lammle.com
为加密会话长生加密密钥
todd(config)#crypto key generate rsa general-keys modules 1024
为ssh会话设置最大空闲定时器
todd(config)#ip ssh time-out 60
为ssh会话设置最大失败尝试值
todd(config)#ip ssh authentication-retires 2
连接到路由器vty线路上
todd(config)#line vty 0 1180
配置ssh并将telnet 作为访问协议
todd(config)#transport input ssh telnet
```

查看配置的命令

```
sh run
```

加密口令

```
todd(config)#service password-encryption
这样在sh run 里面的口令都被加密了
```

do用法

```
odd(config)#sh run
todd(config)#do sh run
Building configuration...
```

设置时钟

```
confg#interface serial 0
config-if# clock rate 64000
```

保存匹配到NVRAM中

```
todd#copy running-config startup-config

todd#copy run start
```

查看当前配置

```
show running-config
```

显示路由器重新加载时所需要的配置

```
show startup-config
```

删除配置及重新加载路由器

```
erase startup-config 
```

将 给 出 硬 件 地 址 、逻 辑 地 址 和 封 装 方 式 ,以及发生 冲突的统计

```
show int f0/0
```

查看 每个 接 口上第 1层 和第 2 层的状态 以及使用 的 IP地 址 的时

```
show protocals
```

显示物理接口自身的信息

```
show controllers serial 0/0
```

# 管理cisco互连网络

## 路由器内部组件：

| 组件                              | 解释                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| bootstrap                         | 初始化阶段启动路由器，然后装入IOS                            |
| post                              | 硬件方面基本功能的检测                                       |
| rom监控程序                       | 存储rom伪代码，用于手动测试和故障诊断                        |
| 微型IOS                           | 型 IC)s是 一 个 在 ROM 中刂以启动接 并将 cisco(B加 载到闪存中的小型 K)s。 微型 I(B也 可 以 执行一些其他的维护操竹 |
| ram                               | 保存高速缓冲、arp缓冲、路由表以及路由器运行所需要的软件和数据结构，也可以从ram运行IOS |
| rom只读存储器                     | 启动和维护路由器，存储post和bootstrap程序                    |
| flash memory                      | 保存cisco IOS，当路由器重新加载时并不擦除闪存中的内容        |
| configure  egister （配置寄存器） | 控制路由器的启动，配置寄存器的值可以在 sllc)w ve邝on命 令输出结 果的最后一行中找到 ,通常为 0妃102,这 个值意昧着路 由器从闪存加载 IC)S, 并告诉路由器从 NVRΛM调 用配置 |
|                                   |                                                              |

## 路由器启动顺序

```
1.路由器执行 POsT(开机自检)。Pf)ST检查硬件,以验证设各的所有组件目前是可运行的。例如,POST检查路由器的不同接口。PC)ST存储在ROM(只读存储器)中并从ROM运行 。
2.bootstrap查找并加载cisco软件。bootstrap是位于ROM中的程 序,用于执行程序。bootstrap程序负责找到每个IOS程序的位置,然后加载该文件。默认情况下,所有 cisco路由器都从闪存加载IOS软件。

提 示 :IOs默认的启动顺序是 闪存 、TFTP服 务器,然后是 ROM。

3.IOs软件在NVRAM中查找有效的配置文件。此文件称为startup config只有当管理员将runnin步 conhg文件复制到NVRAM中时才产 生该文件。正如你已经了解到的 ,新的⒙R路由器中有一个预先加载的小型 startu-config文件 。
灶.如 果 NVRAM中 有 startu广 conhg文 件 ,路 由 器 将 此 文 件 复 制 到 RAM中 并 调 用 run“ ⒈conⅡg。 路由器将使 用此文件运行路 由器 。路 由器 目前是可操作 的。
4、如果NVRAM中没有startupˉ conhg文件,路由器将向所有进行载波 检 测 (car。 er detect, CD)的接口发送广播,查找TFTP主机以便寻找配置 如果没有找到 (一 般情况下都 不会找到———大部分人不会意识到路 由器会尝试这个过程),路 由器将启动 setup mode(设 置模式)进 行配置 
```

### 检查当前配置寄存器的值

```
show version// 系统硬件配置信息、软件版本、配置文件的名称和来源
```

配置寄存器设置为 0x2102,意 味着告诉路由器在 NVRAM中 查找启动顺序。 0x2101设 置告诉路由器从 ROM启 动;  0x2042设 置告诉路由器不要加载 NVRAM中 的 startup-config来 提供 口令恢复功能

修改配置寄存器的可能原因

```
·强制系统进入ROM监 控模式 
·选择启动来源和默认的启动文件名 
·启用或禁用 Break(中 断)功 能 
·控制广播地址 ·设置控制台终端波特率 
·从 ROM加 载操作软件
·启 用 从 TFTP(TⅡ 说 d Rle TranJer Protocol,简 单 文 件 传 输 协 议 )启 动 服 务 器 
```

恢复口令

忘记口令被路由器所在外面：

```
1、启动路由器并通过执行一个中断来启动顺序，这个终端将路由器带入rom监控模式
2、修改配置寄存器以开启为6（0x2142）
		confreg 0x2142
		reset
3、重载路由器
4、进给特权模式
		I初始化，然后在进入特权模式
5、将startup-config文件复制为running-config文件
		copy startup-config running-config
6、修改口令
		conf t
		enable secret todd
7、将配置寄存器重设为默认值
		conf t
		config-register 0x2102
8、保存路由器的配置
9、重载路由器
		boot system flash/tftp/rom 路由器从什么主机启动
```

### 检查闪存的容量

```
show flash //验证闪存 的容 量和要存储到闪存中文件的大小。
show version //能够更精确显示闪存的容量 
note: ,sho flash命令显示所有闪存 中的文件 show version命令显示路由器正在使用的文件名。

```



### 将ciscoIOS从闪存复制到TFTP主机

![1597737853645](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597737853645.png)

note:当提示输入源文件名时,只需从show flash命 令或 show version命 令显示的输出中复 制该文件名并粘贴过来即可。 在这个例子中,闪 存 中的内容被成功复制到 TFTP服 务器 中。远程 主机 的地址是 TFTP服 务器的 IP地 址 。源文件名是闪存中的文件名。 

在备份到网络之前必须完成的操作：确信可以访问网络服务；确信网络服务器有足够的空间保存镜像文件，并且验证所需的文件名和路径 

### 将IOS从TFTP主机复制回闪存

可以使用 copy tftp flash将文件从TFTP服 务器下载到闪存 中,此命令需要TFTP服 务器的 1P地 址以及要下载到闪存中的文件名。 

![1597738543535](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597738543535.png)

### 使用cisco IOS文件系统（IFS）

### 保存路由器的配置

```
copy running-config startup-config
```

### 擦除路由器的配置

```
erase startup-config并重载路由器
```

### CDP思科发现协议

有助于帮助文件存档以及排除网络故障

```
全局模式下：
cdp enable  打开
no cdp eable 关闭
```

收集邻居信息

```
show cdp neighbors   // 只能看到直连设备的 IP地 址 
show cdp neighbors  detail
```

显示每个直连邻居的ip地址

```
show cdp entry * protacols
```

显示每个直连邻居的IOS版本

```
show cdp entry * version
```

收 集 接 口流 量 信 息

```
show cdp traffic //显示了设备发送和接受的cdp数据包的个数
```

手机端口信息

```
show cdp interface /显示端口的cdp数据状态
```

关闭路由器扇某个接受的cdp接口信息：

```
int s0/0/0
no cdp enable
do  show cdp interface
```

通过show running-config和show cdp nerghbors detail来确定路由器的接口

### telnet

连接telnet

```
telnet ip地址
```

查看telnet连接

```
show sessions
```

查看telnet 用户

```
show users
```

验证telnet会话

```
show sessions   //提供你的路由器和其他所有路由的会话
```

关闭telnet 会话

```
exit
```

### 解析主机名

```
两种方法：
1、每个路由器建立一个主机表
2、组建一个类似于动态主机表的DNS
```

建立主机表：

````
ip host hostname tcp_port_number(23)  ip_address;
do show hosts 查看主机表 ，验证主机表
no ip host  删除主机名
````

在路由器的全局模式下添加no ip domain-lookup命令防止费时的查找

DNS域名解析的正常运行

```
ip domain-lookup
ip name-server  服务器的地址
ip domain-name   名称

```

注意 ,DNS服 务器是路由器用来解析名称的。 

traceroute  主机名 命令显示数据包到达远程设备的路径

当路由器的cpu利用率达到50%以上就不合适使用debug功能

查看路由器的cpu利用率和性能的时候使用

``` 
show processes cpu
```

1.将Cisco IOS复制到TFTP服务器的命令是什么?

```
copy flash tftp
```

2.将 Cisco startup-config文件复制到TFTP服务器的命令是什么?

```
copy start tftp
```

3.将 startup-config文件复制到DRAM的命令是什么?

```
copy start run
```

4.将 startup-config复制到DRAM的旧命令是什么?

```
config mem
```

5.用什么命令在你的路由器提示符下査看相邻路由器的IP地址?

```
show cdp neighbor detail or show cdp entry *
```

6.用什么命令可以查看到相邻路由器的主机名、本地接口、平台以及远程端口?

```
show dep neighbors
```

7.按什么键可以同时 telnet到多台设备?

```
ctrl+shift+6   然后X
```

8.什么命令显示同相邻设备和远程设备的活动的 Telnet连接?

```
show sessions
```

9.什么命令可以用于升级 Cisco IOS?

```
copy tftp flash
```

10.什么命令可以使备份配置和RAM中的配置合并在一起?

```
copy tftp run  
copy start run
```

## 实验

### 动手实验5.1:备份路由器1OS

```
1.登录到路由器,并输入en或 enable进人入特权模式。
2.通过从路由器控制台 ping TFTP服务器的IP地址,确信可以连接到网络上的TFTP服务器。
3.输人 show flash查看闪存的内容。
4.在路由器特权模式提示符下输人 show version,以获得路由器当前正在运行的1OS
名称。如果闪存中只有一个文件, show flash和 show version命令显示的文件相同。记住, show version命令显示当前正在运行的文件, show flash显示闪存中的所有文件。
5.一旦知道到TFTP主机有好的 Ethernet连接,也知道IOS文件名,输入 copy flash
tfp备份(OS文件。这个命令告诉路由器将闪存的内容(这是10S默认的存储地点)复制到TFTP服务器。
6.输入TFTP服务器的IP地址和源1OS文件名。文件现在已复制并存储到TFTP服务器的默认目录下。
```

### 动手实验5.2:升级或恢复路由器IOS

```
1.登录到路由器,并输入en或 enable进入特权模式。
2.通过从路由器控制台 ping TFTP服务器的IP地址,确信可以连接到网络上的
rFTP服务器。
3.一且知道到TFTP服务器有好的 Ethernet连接,发出 copy tftp flash命令
4.按照路由器控制台提供的提示进行操作,以确认路由器在恢复或升级期间没有
运行
输人TFTP服务器的IP地址。
6.输入要恢复或升级的IOS文件名。
确认理解了闪存内容将被删除。
8.你会惊奇地看到旧的1OS已从闪存中删除,新的I(OS复制到闪存中。
如果闪存中的文件被删除,但新版本没有复制到闪存,路由器会从ROM监控模式启
动。那就需要搞清楚为什么复制操作没有成功。

```

### 动手实验5.3:备份路由器配置

```
1.登录到路由器,并输入en或 enable进入特权模式
2. ping TFTP服务器,确保到TFTP的IP连接。
3.从 Routerb,输入 copy run tftp。
4.输人TFTP服务器的IP地址(例如,172.16.30.2)并按 Entert(回车)键。
5.路由器将提示你输入文件名。路由器的主机名后面跟着前缀 contg(是的,我拼写的是正确的)。可以使用希望的任何文件名。
Name of configuration file to write [routerb-confg]?
按 Enter(回车)键接受默认名称。
Write file Routerb-confg on host 172.16. 30.2? [confirm]
按 Enter(回车)键。


```

### 使用cisco发现协议

```
将cdp更新定时器设置为90
conf t
cdp timer 90
查看cdp的一些信息
sh cdp ?
```

### 使用telnet

```
P289
```

### 解析主机名

```

```

# IP路由

##  主动路由协议

基本上就是决定数据包通过互联网络最优路径的协议 。主动路 由协议的典型 例子是 RIP、RIPx,~9、EIGRP和 OSPF协 议 

## 被动路由协议

便可用来发送用户数据 (数据包)通过互联网络。被动路 由协议被分派到接 口上并决定数据包的传送方式 。被动路 由协议的典型示例是 IP和 IPv6协 议 。

## 如何配置并验证路由器的IP路由

### 路由选择基础

IP将对接收到的目的 IP地 址为 10.10.10.10的 数据包做什么?

此 数据包将会被路 由器包交换到 F洮tEthemet 0/0接 口,然后这个接 口将这一数据包封装成帧,并把它发送到该网络段中。 

### IP路由的选择过程

![1597825703977](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597825703977.png)

```
1.因特网控制报文协议(ICMP）将创建一个回应请求数据包（在它的数据域中只包含有字母）。
2，ICMP将把这个有效负荷交给因特网协议，然后IP协议会创建一个数据包。这时，这个数据包将包含源IP地址、目的IP地址和值为01h的协议字段（记住，Cisco习惯在十六进制字符前添加Ox，这样便有了0x01的表示）。在本例中，当数据包到达目的地时，所有这内容会告诉接收方主机，它应该将这个有效负荷交给ICMP处理
3，一旦数据包被创建，IP协议将判断目的IP地址是处在本地网络中，还是处在一个远程网络上
4·由于IP协议断定这是一个远程请求，这个数据包需要被发送到默认网关，这样，这个数据包才会被路由到远程网络。Windows注册表将被使用，以查找默认网关。
5，主机172．16．10．2（主机A）的默认网关被配置为172．16．10．1要能够发送这个数据包到默认网关，必须要知道路由器的Ethernet0接口（其IP地址被配置为172．16．10，1）的硬件地址。为什么？因为只有这样，数据包才可以被下传给数据链路层并成帧，然后发送给与172，16．10．0网络连接的路山器接口。在本地局域网上，主机只可以通过硬件地址来进行通信。理解主机A要与主机B通信，它必须将数据包发送到本地网络中默认网关的MAC地址处，这一点是非常重要的。
说明：MAC地址永远都应用于LAN本地，而决不会穿过或通过路由器。
6，接着，检查ARP缓存，查看一个默认网关的IP地址是否已经解析为硬件地址
·如果已经被解析，数据包将被释放、传送到数据链路层并成帧（目的方的硬件地址也将同数据包一起下传至数据链路层）。
·如果这个硬件地址在主机的ARP缓存中尚未被解析，一个ARP广播将被发送到
此本地网络，以搜索172．16．10．1的硕件地址。路山器会响应这个请求并提供Ethernet()的
```

![1597826134149](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597826134149.png)

l.来自主机A的帧中的目的地址将是路由器AFO/0接口的MAC地址。

2．数据包中的目的地址将是HTTP服务器上的网络接口NIC)的IP地址

3．在数据段头中的目的端口号是80。

### EIGRP配置

```
conf t
router eigrp 100
network 网络地址
exit
```



### EIGRP 的特点

```
EIGRP的度量
带宽、延迟、负载、可靠性
EIGRP是一个无类的增强距离矢量协议，它支持IP、IPX和Ap-pleTalk,以及现在流行的IPv6。EIGPR使用被称为DUAL的独特算法来管理路由信息，并使用RTP与其他EIGRP路由器进行可靠的传输。
它允许不平衡开销的负载均衡、可控制的路由选择更新和正式的邻居关系。
EIGPR使用可靠的传输协议（RTP）在邻居间完成通信，并且利用弥散更新算法（DU一AL）来计算到达远程网络的最佳路径。
EIGRP也可以通过对、不连续网络和汇总特性的支持来支持大型网络的应用。
通过在NBMA网络上配置EIGRP操作的能力，EIGRP成为了配置大型网络的真正首选协议。
```

### eigrp故障诊断命令

Show ip route          显示整个路由表

show ip route eigrp  只显示路由表中的EIGRP项目

show eigrp neighbors  显示所有EIGRP的邻居

show ip eigrp topology   显示EIGRP拓扑表中的项目

debug eigrp packet    显示在两台相邻路由器之间发送/接收的Hello数据包

debug ip eigrp notification    显示当EIGRP出现在网络上时它的变化及更新

### 静态路由

```
静态路山具有以下优点:
．对于路山器的CPU没有管理性开綃，它意味着如果你不使用动态路山选择的话，你
可能应该购买更为便宜的路由器·
·在路由器之间没有带宽占用，它意味着在WAN甾接中你可以节省更多的钱·
．它增加了安全性，因为管理员可以有选择地允许路由只访问特定的网络·
静态潞由具有以下缺点：
．管理员必须真正了解所配置的联网洛，以及每台路由器应亥如何正确连接，以证确
配置这些路山。
．如果某个网络加人到互联网络中，管理员必须在所有的路由器0涌过人工）添加对
它的路由。
·对于大型网络来说，这几乎是不可行的，因为这时静态路由会导致0大的工作量。
```

### 动态路由

### ospf

启动或配置ospf时，,必 须删 除 EIGRP,因 为它们 具 有 比OSPF更 低 的 管 理 距 离 。

管理距离

```
ospf  110
eigrp 90
rip 120
```

```
比较OSPF和RIPv10
OSPF是一个链路状态协议，它支持VISM和无类路由选择。
RIPv1是一个距离矢量协议，它不支持VLSM，并且它只支持有类路山选择。
```

```
ospf路由器如何成为邻居：
了解OSPF路由器是如何变成邻居和/或邻接的。当每台路由器看到其他路由器的
Hello数据包后，OSPF的路由器就会成为邻居。
```

特性：

```
·由地区和自治系统组成
·最小化的路由更新的流量
．允许可缩放性
．支持VLSM/CIDR
．拥有不受限的跳计数
·允许多销售商的设备集成（开放的标淮）
```

ospf与rip之间的差别

![1597890528503](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1597890528503.png)

​    ospf常见层次结构的原因：

```
减少路由选择的开销 
加速会聚 
用单一的网络地区来缩小网络的不稳
```

ospf的基础知识

```
hello数据包的地址是：224.0.0.5
链路状态通告包含了路由器中链路状态和路由信息
```

ospf的单区域配置

```
conf t
no router eigrp 10  //设置ospf之前需要先关闭eigrp 
router ospf 1  //开启ospf
network <子网号> <通配符掩码> area 0
```

通配符的计算

```
需要记住的是，当配置通配符时，它们的取值总是块尺寸减去1。/28的块尺寸为16，因此当我们添加网络声明时、使用了此子网号和一个在需配置的八位位组中添加值为15的通配符。对于／30，它的块尺寸为4，因此，所使用的通配符为3。
或者直接0.0.0.0
```

note::重要提示,OSPF只 可以在代价相等的链路上进行 负载均衡。它不能像 EIGRP 一样可以在代价不相等的链路上进行 负载均衡 

显示ospf的信息

````
show  ip ospf
````

显示路由器的编号和相邻路由器的id

```
show ip ospf database
show ip ospf neighbor
show ip ospf interface
```

查看路由选择协议

```
show ip protocals
```

ospf排错

| 命令                 | 功能                                  |
| -------------------- | ------------------------------------- |
| debug ip ospf packet | 显示在路由器上被发送和接受的hello报文 |
| debug ip ospf hellp  | 显示更详细 的hello报文信息            |
| debug ip ospf adj    | 显示广播和非广播多路访问上的DR和BDR   |

DR和BDR的选举

``` 
DR和BDR的选择是通过Hello协议来完成的。在每个网络分段上，Hello数据包是通过IP组播来交换的。然而，只有在广播和非广播的多路访问网络（如以太网和帧中继）的网络分段上才会进行DR和BDR的选举。点到点链路，例如串行WAN连接，将不会进行DR的选举过程。
在广播和非广播的多路访问网络上，网络分段中带有最高OSPF优先级的路由器将会成为本网络分段中的DRO这个优先级在默认时取值为1，可以使用how ip ospf interface命令来查看它。如果所有的路由器都使用默认优先级设置，那么带有最高路由器ID（RID)的路由器将会胜出。

DR和BDR选择发生的过程：debug ip ospf adj
```

环回接口

```
不论路由器是否配置OSPF．都最好配置一个环回接口。
在OSPF配置中使用环回接口，是为了确保在()SPF进程中总有一个激活的接口。
作用：
它们可以用于OSPF的配置和诊断。在路由器上配置环回接口的原因是，如果你不配置环回接口，路由器上的最高IP地址将成为此路由器的IRIDO而此RID则用于通告路由以及选举DR和BDR。
说明：在默认时OSPF使用在其启动时任一激活接口的最高IP地址。然而．可以使用逻辑接口来取而代之。任何逻辑接口的最高IP地址将总会成为路由器的RIDO
```

配置环回接口

```
conf t
int loopback 0
ip address ip地址  255.255.255.255
```

ospf优先级

  ```
路由的默认的优先级都为1 ，不指定的话默认路由器的RID最大的就是DR，指定某路由器为DR有三种方法：

配置路由器R2上Fa0/0接口的优先级比该以太网中任一其他接口的优先级高。
int f0/0
ip ospf pirority 2
在R?上配置一个环回接口，并使它的IP地址比其他路由器上的任一IP地址高。
将RI和R3的Fa0/0接口的优先级值修改为0。
  ```

汇聚网络

```
将area1中的网络汇聚到area0
area 1  range <聚合后的网络> <聚合后的掩码> 
```



### 课后习题

````
l.EIGRP支持的4个被动路由协议是什么？
		IP IPv6 IPX AppleTalk
3，什么命令用于启用带有自治系统号300的EIGRP？
		router eigrp 300
4．什么命令将告诉EIGPR，它已经被连接到网络172．10．0．0？
		network 172.XXX
5．什么类型的EIGPR接凵既不能发送也不能接收Hello数据包？
		被动接口
6．写出在某台路由器上可以启用OSPF进程101的命令。
		router ospf 101
7．写出可以显示路由器上所有已启用OSPF路由选择进程细节的命令。
		show ip ospf
&写出显示特定接口上()SPF信息的命令。
		show ip ospf interface
9．写出显示所有OSPF邻居的命令。
		show ip ospf neighbor
10．写出显示当前路山器所了解的不同OSPF路由类型的命令。
		show ip ospf database
````

### 选取DR

```
1•凸先按照图7．12所示将网络连接起来。为该网络创建IP方案，就像一些简单的地址方案．如10．1.l.1/24、10．l.l.2/24和10．1.1.3/24等，就能很好地工作。
2，现在来配置OSPF，将所有的路由器都放置在地区0中。在这个实验中只有以太网的局域网接凵需要被配置，因为，正如你所知道的，在串行连接上不会进行选举。
&接下来，在每台路由器上输人showipospfinterfaceeo来验证地区ID、DR、BDR的信息，以及与局域网相连接口的Hello和Dead定时器。
4，通过查看showipospfinterface，判断哪台路由器将会是DR和BDR
5，现在来验证路由器的网络类型。山于该连接是在以太网上的，此网络类型应该是BROADCASTc如果查看串行连接，将会看到类型为点到点网络
6．在这里，需要为路由器设置优先级。在默认时，所有路由器的优先级都是1。如果你将优先级改为0，路由器将决不会参加此局域网上的选举过程（住，在串行的点到点链路上不会进行选举）。
7、这里你需要确定哪台路山器将成为新的DR。
8．接下来，开启debug过程，这样你将可以看到所发生的DR和BDR选举过程。在所有的路山器上输人debugipospfadjacency
9．这里，通过输人ipospfpriority3将新DR的以太网0接凵的优先级设置为3。
10．接下来，关闭DR路由器的以太网接口，然后再用noshutdown命令将它开启。显然，如果此时你己经telnet到此路由器中，那么这一操作将会使你失去telnet的会话。
ll.现在选举将再次进行，并且你所选定的DR路由器将真正成为DRO
12．最后，输人showipospfinterface命令来验证每台路由器上的DR和

```

# 交换和生成树协议

### 交换机和网桥的取别

```
·网桥是基于软件的，而交换机是基于硬件的，因为交换机使用ASIC芯片来帮助做出
过滤的决定。
·交换机可以看成是多端口的网桥。
·每个网桥只有一个生成树实例，而交换机可以有许多生成树实例（马上就会讨论这一
·交换机的端口数量比大多数网桥都多。
·网桥和交换机都转发第2层广播。
·通过检查所接收的每个数据帧的源地址，网桥和交换机就学到了MAC地址。
·都是基于第2层地址做出转发的决定
```

### 二层交换的三种不同的功能

### 地址学习

```
第2层交换机和网桥能够记住在一个接口上所收到的每个帧的源设备硬件地址，而且它们会将这个硬件地址信息输人到被称为转发/过滤表的MAC数据库中
案例：
机A向主机B发送一个帧。主机A的MAC地址是0000，8c01.000A，主机B的
MAC地址是0000，8c01.000B。
2．交换机在EO/0接口上收到帧，并将源地址放人MAC地址表中。
3，由于目的地址不在MAC数据库中，帧就被转发到所有接口上。
4，主机B收到帧并响应了主机AO交换机在接口E00上收到此帧，并将源硬件地址放人MAC数据库中。
5．主机A和主机B现在可以实现点到点的连接了，而且只有这两台设备会收到帧。主机C和主机D将不会看到帧，在数据库中也不会找到它们的MAC地址，因为它们还
没有向交换机发送帧
```

### 转发/过滤决定

```
当在某个接口上收到帧时，交换机就查看其目的硕件地址，并在MAC数据库中找到其外出的接口。帧只被转发到指定的目的端口。
P443
端口安全：防止非授权用户将集线器交换机街道办公室的快速以太网接口上，或者是用户主机接入到交换机上：
conf t
int f0/0
swithport port-security ?
S1(config)#swithport port-security maxinum 1	
S1(config)#swithport port-security mac-address sticky
S1(config)#swithport port-security mac-address violation shutdown

上述命令在端口fa0/3和fa0/4上设置端口安全，允许关联的最多MAC地址为一个，只有关联到端口的第一个MAC地址才能通过交换机发送帧。如果具有不同MAC地址的第二台设备试图向交换机发送帧，那么端口将由于violation命令的存在而被关闭。我使用的是sticky命令，因为我太懒了，不愿意通过手工输人每台设备的所有MAC地址。
```

![1598055490491](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1598055490491.png)

### 查看转发/过滤表

```
show mac address-table
```

### 避免环路

```
mac地址表震荡
广播风暴
多帧复制

```

## 生成树协议

```
协议的任务：找到网络中的所有链路,并关闭任何冗余的链路,这样 就可以防止网络环路的产生
根桥：桥ID最低
	桥ID是由桥优先级和mac地址决定的
根端口：连到根桥的链路所在的端口，或者是到根桥的路径最短的端口
指定端口： 开销最小的端口，也成为转发端口
非指定端口：通常被设置为阻塞状态

选取根桥：
do show spanning tree  //查看生成树系欸
conf t
spanning-tree vlan 1 priority ?
spanning-tree vlan 1 priority number

show spanning-tree  /再次查看

将某个端口设置为快速端口
int f0/0
spanning-tree portfast trunk/diasable

生成树端口五种状态
阻塞（Bng）被阻塞的端口将不能转发帧，它只监听BPDU，默认情况下所有的端口都处于阻塞状态。
侦听（Listening)端口都侦听BPDU，以确信在传送数据帧之前，在网络上没有环路产生。处在侦听状态的端口，在没有形成MAC地址表时，就准备转发数据帧。学习(Learning)交换机端口侦听BPDU，并学习交换式网络中的所有路径。处在学状态的端口形成了MAC地址表，但不能转发数据帧。转发延迟意味着将端口从侦听状转换到学习状态所花费的时间，默认时设置为巧秒，可以用命令showspanning-tree显示出来。
转发(Forwarding)在桥接的端口上，处在转发状态的端口发送并接收所有的数据帧。如果在学习状态结束时，端口仍然是指定端口或根端口，它就进人转发状态。
禁用（Disabled）从管理上讲，处于禁用状态的端口不能参与帧的转发或形成STP。处于禁用状态下，端口实质上是不工作的。
```

### uplinkfast

```
用来确定并快速修复链路失效 当交换机至少有一个可选/各份的根端 口(处于阻塞状态的端 口)时 ,U山 nkh哎 允许交换机在主链路失效前找出到根桥的可选路径 
conf t
spanning-tree uplinkfast
do show spanning -tree uplinkfast
```

### backbonefast

```
spanning-tree backbonefast
do show spanning-tree backbonefast
```

### RSTP

```
conf t
spanning-tree mode rapid-pvst
```

### EtherChannel

```
conf t
int port-channel 1
int range f0/1-2
switchport trunk encap dot1q
swithport mode trunk
swithport nonegotiate
channel--group 1 mode desirable
do show int f0/1 etherchannel
```

### 章节练习

```
2，如果某个目的MAC地址不在转发/过滤表中，交换机将如何处理帧？
		将帧扩散到除了接收端 口之外的所有端 口上 
4．如果在交换机端口上收到一个帧，但其源MAC地址不在转发/过滤表中，交换机将如何处理？
		它将在转发/过滤表中添加源MAC地址,并将它与收到此帧的端口联系起来 
6．802.1w又称为什么？
		快速生成树协议 
7．什么时候STP被认为是收敛的？
		当所有的端口都处于阻塞或转发状态时	
10．哪一种Cisco802，1d扩展能够阻止BPDU从一个端口发送出去？
		portfast
```

# Vlan

### vlan的作用

```
·通过将某个端口配置到合适的VLAN中，就可以实现网络的添加、移动和改变。
·将对安全性要求高的一组用户放人VLAN中，这样，VI-AN外部的用户就无法与它们通信。
·作为功能上的逻辑用户组，可以认为VI-AN独立于它们的物理位置或地理置。
·VLAN可以增强网络安全性，
·VLAN增加了广播域的数量，同时减小了广播域的范围。
在下面各节中，将讨论交换机的特性，并讨论在目前的网络中，交换机怎样为我们提供
```

  VI'AN之 间的通信必须通过第 3层 设备进行 ,因此 ,我们 确实需要路由器

访问端口

```
如果你让某个端口成了访问端 冂,那么那个端口就只能被分配给某一个 VLAN。 
```

中继端口

```
中继端口能承载多个vlan
```

中继链路优点

```
中继可以使单个端口同时成为多个不同VLAN的一部分
中继的另一个好处体现在连接交换机时，中继链路可以跨链路传送各种VLAN信息
```

###  VTP帧中继协议

```
目标:
跨交换式压联网络管理所有已经配置好的VI-AN,)i-在那个网络上维护其一致性。
VTP允许管理员对VI-AN进彳添加、删除和更名，并将这蚱后息传播到vTP域中的所有其他交换机0VTP必须提供的一些好处如下·
·在网络中所有的交换机上实现VLAN配置的一致性
·允许VLAN在混合式网络中实现中继链路，比如从以太网到ATMLANE或FDDI
．VLAN的精确跟踪和监控
·将所添加的VLAN动态报告给VTP域中的所有交换机
·添加VIAN时的即插即用

对于VTP在交换机之间传送VI-AN信息，必须知道下面3种需求：
· 两台交换机的vTP管理域名必须设置为一样的
· 其中一台交换机必须配置为VTP服务器
．不需要路由器

VTP的操作模式：
服务器、客户机、透明模式     
```

### VTP命令

## VLAN间路由

### 单臂路由器

```
这样会产生瓶颈和单点失效，因此，主机和VLAN的数量会受到限制。
到底为多少呢？这取决于流量情况。
```

### Vlan的配置

VLAN1是本机VLAN且是负责管理的VLAN，所以一般都是i从vlan2开始

```
可以创建的vlan号2-4096
conf t
vlan 2
name hospital

show vlan /查看vlan
show intface trunk   //查看中继端口

设置访问端口的类型：
swithport mode access/fynnamic/trunk mode/trunk
switchport access在前一节讨论过这一点。这个命令使得接口（访问端口）成为永久性的非中继模式，并协商将链路转换为非中继链路。不管邻居接口是否是中继接口，该接口都将成为非中继端口。这种端口是专用的第2层端口。
switchport mode dynamic auto这个命令使得接口将链路转换为中继链路。如果邻居接口设置为中继或需要的模式，该接口将变成中继接口。
switchport mode dynamic desirable这个命令使得接口试图动态地将链路转换为中继链路。如果邻居接口设置为中继、需要的或自动模式，该接口将变为中继接口。
switchport mode trunk这个命令使得接口成为永久性的中继模式，并协商将邻居链路转换为中继链路。即使邻居接口不是中继端口，该接口也将变成中继端口。
switchport nonegotiate这个命令用来防止接口产生DTP帧。仅当接口的swithport mode是access或trunk时，才能使用这个命令。必须手工地将邻居接口配置为中继接口，以建立中继链路。

在某个端口上禁用中继，只需要swithport mode access，返回第二层协议就可以了

```

### 在交换机上配置中继

```
switchport trunk encapsulation dot1q/isl/negotiate
switchport mode trunk
正如大家所看到的，这里有一个选项，可以用来在3560交换机上添加IEEE802．IQ(dotiq)封装或ISO封装。在设置了封装之后，还必须将接口模式设置为中继。
```

### 在中继端口上定义允许的vlan

```
conf t
int f0/0
weitchport trunk allowed vlan add/all/except/mone/remove
no swithport trunk vlan all……  //撤回
```

### 本机vlan

```
所有交换机必须使用相同的本机VLAN，否则就会出现严重的问题。下面，让我们将路由器连接到交换式网络中，并配置VLAN之间的通信。
```

```
note;
．连接到交换机的路由器使用了子接口。  int f0/0 no ip   no sh 
．连接到路由器的交换机端口是中继端口 mode trunk
·连接到客户机和集线器的交换机端口是访问端口，而不是中继端口。 
```

     ### VTP域配置

在创建VTP域时，有一些选项，包括设置域名、口令、操作模式和交换机的修剪功能。 可使用vtP全局配置模式命令来设置所有这些信息。在下面的例子中，我将交换机Sl设置 为vtPserver,将VTP域名设置为Lammle，将VTP口令设置为todd,默认所有的交换机都属于VPT服务器模式，要是需要去改变主机的某些信息，就必须要从vtp服务器上修改

```
Switch(config)#vtp mode server
Switch(config)#vtp domain lammle
Switch(config)#vtp password todd
show vtp password 
show vtp status

vpt客户机的配置
Switch(config)#vtp mode client
Setting device to VTP CLIENT mode.
Switch(config)#vtp domain lammle
Domain name already set to lammle.
Switch(config)#vtp password todd
Password already set to todd
Switch(config)#do show vtp status
```

### VPT故障排除

```
show vtp status 如果两个服务器使用了两个不同的域名，永远不会共享信息
如果vtp的模式为客户机模式，那么就不能对vlan进行增删改查

具有相同域名的vtp服务器。但是交换机B不能从交换机A接收VLAN信息，因为交换机B的版本号比交换机A的要高一些。大家一定要能够识别出这种问题，这一点非常很重要。
要解决这个问题，可以有好几种方法。需要做的第一件事情是，在交换机B上改变VTP域名，然后将它新设置为GlobalNet，这将使交换机B上的版本号重新设置为0。第二种方法是，在交换机A上创建或删除VLAN，直到其版本号超过了交换机B上的版本号。我并没有说第二种方法更好一些，我只是说，还有另外的方法来解决这个问题！
```

### 语音vlan

```
VLAN，对来自与电话相连的设备（比如PC机）的数据流量使用另一个VLAN。可以在交换机上配置访问端口，以发送CDP包，指示相连的CiscoIP电话以下述任何方式向交换机发送语音流量：
·带标记的语音VLAN，具有第2层COS优先级值
·带标记的访问VLAN，具有第2层COS优先级值
·不带标记的访问VLAN(没有第2层COS优先级值）
在CiscoIP电话上，交换机也能处理来自连接到访问端口的设备的、带标记的数据流量（IEEE802．IQ或IEEE802．Ip帧类型的流量）。可以在交换机上配置第2层访问端口，以发送CDP包，指示相连的CiscoIP电话以下述方式之一配置IP电话访问端口：
·在信任模式下，通过CiscoIP电话的访问端口所接收的所有流量，都毫无改变地通过IP电话。
·在非信任模式下，通过IP电话的访问端口所接收的、所有以IEEE802，IQ或IEEE802，Ip帧格式所表示的流量，都会接收到已配置好的第2层COS值。默认的第2层COS值为0。默认时，为非信任模式。

配置语音VLAN
·应当在交换机的访问端口上配置语音VLAN。即使在中继端口上配置了语音
VI-AN，中继端口也不支持它。
·语音VI-AN应当在交换机的IP电话端口上呈现并有效，以便正确地进行通信。使用特权EXEC命令show vlan，可查看VLAN是否存在，如果存在，就会显示在输出中。
·在启用VLAN之前，建议大家在交换机上输人全局配置命令mls qos，以启用QoS，
并输人接口配置命令mls qos trust cos，将端口状态设置为信任模式
·必须确信在连接到CiscoIP电话的交换机端口上启用了CDP，以发送配置信息。默认时它是启用的，因此，除非你禁用了它，否则就不会有问题。
·在配置了语音VLAN之后，PortFast特性就自动启用了，但如果禁用了语音
VLAN，PortFast特性则不会自动禁用
．要让端口回到其默认设置，可使用接口配置命no switchport voice vlan
```

配置

```
2．怎样配置端口，以便为语音流量使用IEEE802，Ip优先级标记。
3．怎样配置它，以便使用VoiceVLAN（10）承载所有语音流量。
4“最后，怎样配置VLAN3，以承载PC数据。

Switch(config)#mls qos
Switch(config)#int f0/1
Switch(config-if)#switchport priority extend trust
Switch(config-if)#mls qos trust cos
Switch(config-if)#switchport voice vlan dot1p
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 3
Switch(config-if)#switchport voice vlan 10
```

## CNA的使用

## SDM的使用

## 章节练习

```
理解术语“帧标记”。帧标记与VLAN标识有关，当帧正在穿越交换机结构时，交换机使用帧标记来跟踪所有的帧。这样，交换机就能够识别出哪一个帧属于哪一个VLAN。

理解ISLVIAN的识别方法。交换机间链路（ISL）是一种在以太网帧上显式地标记VLAN信息的方法。通过一种外部封装方法，这种标记信息允许VLAN在中继链路上实现多路复用，从而允许交换机在链路上识别帧的VLAN成员关系。ISL是Cisco专用的帧标记方法，只能用于Cisco交换机和路由器中。

理解802IQVLAN识别方法。这是非专用的IEEE帧标记方法。如果你正在Cisco的交换式链路和不同品牌的交换机之间配置中继链路，就必须采用802．IQ,以便让中继起作用。记住怎样在2960交换机上设置中继端口。要在2960交换机上设置中继端口，可使用switchportmodetrunk命令。在接入一台新的主机时，记住检查交换机端口的VLAN分配。如果在交换机中接人
了一台新的主机，就必须验证那个端口的VLAN成员关系。如果端口的成员关系与主机所需要的成员关系不一样，主机将不能得到所需的网络服务，比如不能访问工作组服务器。

理解VTP的作用及其配置。VTP用来在整个交换式网络中传播VLAN数据库信息。所有的交换机都必须配置在同一个VTP域中。

记住怎样创建Ci“独臂路由器”，以提供VLAN之间的通信。可以使用Cisco快速以太网或吉比特以太网接口来提供VLAN之间的路由。连接到路由器的交换机端口必须是中继端口，然后，必须在路山器端口上为每个相连的VLAN创建虚拟接口（子接口每
个VLAN中的主机都将用这些子接口地址作为它们的默认网关地址。
```

```
1.哪一种VTP模式只能接收VLAN信息而不能改动VLAN信息？
			交换机
2，哪一种VLAN识别方法是Cisco路由器专用的？
			交换机间链路（ISL）
5．默认的VTP模式是什么？
			服务器模式
6．中继能够提供什么功能？
			使得当个端口能够成为多个vlan的一部分
7，什么是帧标记？
			独一无二的给每个帧分配一个用户定义ID，
8，正确/错误：如果帧是通过访问链路转发出去的，那么就从帧中删除ISL封装。
			正确
9，哪种类型的链路只是某个VLAN的一部分，并被称为端凵的“本机VLAN”？
			访问链路
```

# 安全

##  常见的攻击

### 应用层攻击

```
瞄准运行在服务器上的软件漏洞，而这些漏洞众所周知。各种目标包括FTP、发送邮件、HTTPO因为这些账户的许可层都获得了一定的特权，如果这台计算机正在运行以上提到的应用程序中的一种，恶意者就可以访问并掠取计算机资源

```

### Autorooters

```
你可以把它想象为一种黑客机器人。恶意者使用某种叫做rootkit的东西来探测、扫描并从目标机器上捕获数据，装了rootkit后的目标机像是在整个系统中装了“眼睛”一样，自动监视着整个系统。
```

### 后门程序

```
后门程序通往一个计算机或网络的简洁的路释。经过简单人侵或是经过更精心设计的特洛伊木马代码，恶意者可使用植人攻击进人一台指定的主机或是一个网络，无论何时它们都可进人一一除非你发觉并阻止它们，就是这样！
```

### 拒绝服务

```
和分布式拒绝服务（D娲）攻击这些攻击很恶劣一一一摆脱它们同样也很费力。即使黑客们都鄙视使用这种攻击的黑客，因为它们如此令人厌恶，但是它们真的很容易就能实现（这意味着10岁的人都可以让你屈服，这非常不公平！）。从根本上说，当一个服务超范围索取系统正常提供它的资源时，它将变得不正常。而且存在不同的攻击风格
```

### TCP /SYN 洪泛攻击

````
发生在一个客户端发起表面上普通的TCP连接并且发送SYN信息到一台服务器时。这台服务器通过发送SYN-ACK信息到客户端进行响应，这样就通过往返ACK信息建立连接。听起来很好，但是正是在这个过程中一一当连接仅有一半打开的时候一一受害的机器将完全被蜂拥而至的半打开连接所淹没，最终导致瘫痪。
````

### “死亡之ping”

```
攻击你可能知道TCP/IP的最大包大小为65536字节。不知道也没关系一一仅需要了解这种攻击通过使用大量数据包进行ping操作来实行，这些数据包可导致没备不间断地重启、停滞或是完全崩溃。
```

### 族群式泛洪攻击（TFN）和族群式2000泛洪攻击

```
这些令人厌恶的少数群体可变得复杂，因为它们从多个源头同步发起D。S攻击并且可以定位目标到多台设备。这种攻击能取得成功，部分归因于称做“IP欺骗”的东西，不久将对此进行描述。这种攻击实际上是攻击方法的大杂烩，德语翻译为带刺铁丝网。它基本上混合了TEN并且加人了一点密码。它开始于root级的非常人侵，以S攻击结束。
```

### IP欺骗

```
IP欺骗这有点像它的名字一样一一恶意者从你的网络内部或外部，通过做下列两件事之一：以你的内部网络可信地址范围中的IP地址呈现或者使用一个核准的、可信的外部IP地址，来伪装成一台可信的主机。因为黑客的真实身份被隐藏在欺骗地卅之下，所以这经常仅是你的难题的开始
中间人攻击拦截住！但是这并不是足球，它是一串网络信息数据包一一一你珍贵的数
据！一个常见的犯罪团队可能是为ISP工作的某些人，使用叫做包嗅探（以后会讨论）的工
具，并在此基础上增加路由和传输办议。
在侵人一个网络之前，黑客经常会收集所有关于这个网络的信息，因为他们
```

### 中间人攻击

```
拦截住！但是这并不是足球，它是一串网络信息数据包一一一你珍贵的数据！一个常见的犯罪团队可能是为ISP工作的某些人，使用叫做包嗅探（以后会讨论）的工具，并在此基础上增加路由和传输办议。
```

### 网络侦察

```
口令攻击 这种攻击有许多方式，可经由多种较成熟类型的攻击实现，这些攻击包括
```

### 包嗅探

```
在侵入一个网络之前，黑客经常会收集所有关于这个网络的信息，因为他们对网络知道越多越容易造成危害是刚提到的那个工具，但是我没有告诉你它是什么，可能得知它竟是一个软件时你会觉得有些惊奇。这就是它的工作原理一一网络适配卡开始工作于混杂模式，它发送的所有包都可以被一个特殊的应用程序从网络物理层偷取，并进行查看及分类。包嗅探常偷取一些价值高、敏感的数据，其中包括口令和用户名，在实施身份盗取时能获得超值的信息。
```

### 口令攻击

```
口令攻击 这种攻击有许多方式，可经由多种较成熟类型的攻击实现，这些攻击包括IP欺骗、包嗅探 以及特洛伊木马，它们唯一的目的就是一一一惊喜一，一发现用户的口令，这样，小偷就可以伪装成一个合法的用户，访问用户的特许操作及资源。强暴攻击  另一种面向软件的攻击，使用运行在目标网络的程序尝试连接到某些类型的共享网络资源。如果访问账户拥有很多特权，对于黑客来说这是非常完美的，因为这些恶意者可以开启后门，再次访问就可以完全绕过口令。
```

## 降低网络威胁

```
使用acl降低安全威胁
```

### cisco IOS防 火 墙

### ACL

```
本质是对是一些列对包进行分类的条件，，可以用在控制流量的工具
标准访问控制列表（1-99  and 1300-1999）： 只使用IP数据包的源ip地址作为测试条件    目的端口
扩展访问控制列表（100-199 and 2000-2699）：可以测试源ip地址和目的ip地址，以及网络层报头中的协  议字段和传输层的端口号  尽量放在源端口，过滤特定的地址和协议，并不希望它穿过了整个网络之后在拒绝，所以要从源头上拒绝
```

### 使用acl降低安全威胁

```
acl能过滤的安全问题：
·IP地址欺骗，对内
·IP地址欺骗，对外
·拒绝服务（DOS)TCPSYN攻击，阻塞外部攻击
·DOSTCPSYN攻击，使用TCP截取
·DOSsmurf攻击
·过滤ICMP信息，对内
·过滤ICMP信息，对外
traceroute
一般明智的做法是不允许任何包含内网中任一主机或网络源地址的IP包进人专用网定要禁止。
下面列出了一些从因特网到企业网中配置ACL时减轻安全问题的规则：
·拒绝任何来自内部网络的地址
·拒绝任何本地主机地址（127．0．0，0/8）
·拒绝任何保留的专用地址
·拒绝任何IP组播地址范围（224，0．0．0/20之中的地址
```

### 标准控制访问列表

```
access-list 10 deny/permit/remark host/any/hostname or A.B.C.D
access-list deny host 通配符掩码
host一般为网络地址吧？
通配符掩码的选择：
0.0.0.0 代表每个八位位组必须精确匹配
0.0.0.255 代表前三个八位位组必须精确匹配

若从172.16.16.0开始，持续8个块到达172.16.23.0
access-list 10 deny 172.16.16.0 0.0.7.255
通常情况下通配符为下一个网络-1
```

![1598343482782](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1598343482782.png)

![1598345688092](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1598345688092.png)

### 控制VTY访问

```
1、创建一个标准访问列表，只允许哪些你希望的主机能够远程登录到路由器
2、使用access-class 命令将此访问列表应用到VTY上
Router(config)#access-list 1 permit 172.14.10.2 
Router(config)#line vty 0 4
Router(config-line)#access-class 1 in

写出vty线路上范文控制列表的命令
Router(config)#access-list 110 permit ip any any
Router(config)#line vty 0 4
Router(config-line)#access-class 110 in
```

### 扩展访问控制列表

```
Router(config)#access-list 110 deny tcp any host 172.167.12.2 eq 21
Router(config)#access-list 110 deny tcp any host 172.167.12.2 eq 23
Router(config)#access-list 110 permit ip any any
Router(config-if)#ip access-group 110 out
阻止所有从外部到内部主机的FTP和telnet访问
```

### 交换机端口的控制访问链表

```
访问控制列表也可用于虚拟局域网的流量控制。为了实现此功能，需要把端口访问控制列表应用到一个中继端口。但是要谨慎一一如果你在一个具有语音VLAN的端口上使用访问控制列表控制流量，那么它也会过滤你的数据VLAN流量。因此这点要很小心。
端口访问控制列表通过IP访问列表控制IP流量。任何非IP流量通过使用MAC地
址过滤。尽管你可以把两种类型的过滤应用在一个单独接口上，但是每次只能应用一种。
mac access-list extended access-lsit_name
deny any host macaddr
mac sccess-group access-list_name in/out
```

### 动态控制访问列表

```
原理是这样的：用户发起的Telnet连接被丢弃，并且被已经附加到扩展访问控制列表上的一个单条目动态访问控制列表所取代。这将导致在特定时间内允许流量通过，而且像你猜到的那样，也会有时间限制。
```

![1598358843119](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1598358843119.png)



### 章节练习

```

4．写出一个验证已经正确地输人了访问列表的命令。
		show access-list
5．写出两个验证访问列表已正确地应用到以太网接口上的命令。
		show running-config
		show ip interface
写出用于创建一个阻止主机172，16．10，1远程登录到主机172，16．30，5的扩展访问列表的命令。
	Router(config)#access-list 110 deny tcp host 10.172.16.1 host 172.1.30.5 eq 23

]0，写出验证访问列表的应用位置和方向的命令。
		show ip interfaces
		
显示在接口上应用了哪些访问列表的唯一一个命令是
show ip interface Ethernet 0
命令showaccess-lists显示所有配置的访问列表，
show ip access-lists显不所有已配置的IP访问列表，但这两个命令都不能指明显示的列表是否已应用到接口上。
```

#  网路地址转换

### 目的

是允许把私有 IP地 址映射到外部 网络的合法 IP地 址 ,以减缓可用 IP地 址空间的消耗 。 

### 使用范围

```
你需要连接到因特网，但是你的主机没有公网IP地址。 
你更换了一个新的ISP，需要重新组织网络 
你需要合并两个具有相同网络地址的内网。
```

### 优缺点

```
优点：节约合法注册地址
	减少地址重叠出现
	增加连接因特网的灵活性
	网络变更时避免地址的重新分配
缺点：
	地址转换产生交换延迟
	无法进行端到端的ip跟踪
	某些应用无法在实施net的网络中运行
```

### nat术语

| 名字         | 意义               |
| :----------- | ------------------ |
| 内部地址     | 转换之前内部源地址 |
| 外部地址     | 转换之前外部源地址 |
| 内部全局地址 | 转换之后内部源地址 |
| 外部全局地址 | 转换之后外部源地址 |

### 工作原理

```
主机1.1.1发送一个外出数据包到配置了NAT的边界路由器。边界路由器识别出此IP地址为内部本地IP地址．目标是外部网络，它要转换内部本地IP地址，并把转换结果记录到NAT表中：这个数据包使用转换后新的源地址被发送到外部接口。外部主机返回此包到目标主机，NAT路由器使用NAT表转换内部全局IP地址为内部本地IP地址。整个过程就是这么简单。
```

### 静态nat配置

```
ip nat inside source static 内部本地地址  内部全局地址
int ethernet0
ip addr x.x.x.x
ip nat inside

int serial0

ip addr x.x.x.x
ip nat outside
```

### 动态nat配置

动态nat意味着我们可以为内部用户组提供真实的地址池，我们不适用端口号，因此我么们必须为每个尝试连接外网的用户提供真实的ip地址

```
Router(config)#ip nat pool  todd  170.168.2.2 170.168.2.2 netmask 255.255.255.0 
Router(config)#ip nat inside source list 1 pool todd

```

### PAT（复用）配置

pat的好处是存在于这种配置和卡面的动态nat配置间的差异是ip地址池被缩减为一个ip地址，并且在IP nat source 命令之后包含了overload命令，ip地址为外部接口ip地址

```
ip  nat pool globalnet 170.168.2.1  170.168.2.1 netmask 255.255.255.0   //pool的起始地址和中止地址
ip nat inside source list 1 pool globalnet overload 

int serial0/0
ip addr x.x.x.x x.x.x.x
ip nat outside
```

### nat的简单认证

```
show ip nat translation   //查看ip地址的转换信息
debug ip nat 验证nat
```

### 测试和诊断nat故障

```
．检查动态地址池一一它们是否由正确的地址范围组成
．检查动态地址地是否有重叠
·检查被用来静态映射的地址与动态地址池中的地址是否重叠
·确定你的访问列表指定正确的转换地址
．确信列表中该出现的地址没有遗漏，不该出现的地址没有被加人
。确信内部和外部接口都已经恰当地界定


Router(config)#do show ip nat statistic  //得到nat配置的汇总目录，并且对活动的转换类型进行计数

clear ip nat translations  用来清除条目一一经由全局或本地地址，或是通过TCP和UDP转换（包括端口）指定一个单独条目，或者输人星号（）删除整个条目表。但是要知道，如果你这么做了，仅动态条目被删除，因为此命令不删除静态条目。
```

### 章节练习

```
1.哪种类型的地址转换使用一个地址允许多个主机地址的转换？
	pat 端口地址转换
2．使用哪个命令显示路由器上的NAT转换？
	debug ip nat
3．使用哪个命令显示转换表？
	show ip nat translations
4·使用哪个命令清除转换表中的NAT条目？
	clear ip nat translations *
5．每一个NAT映射使用多少内存（大约）？
	160字节
6．为什么使用ipnattranslationmax-entries命令？
	nat 条目很少回因为性能和策略的原因收到限制
7，使用哪个命令可排除故障，并且显示NAT配置汇总、活动的转换类型数目及当前映射的匹配数目？
	show ip nat statistics
8，在NAT转换地址前需要在路由器接口使用哪个命令？
	 ip nat inside  ip nat outside
9．以下是使用哪种类型NAT的输出？
ip nat pool todd-nat 170．168．10．10 170．168．10．20 netmask 255·2S255．0
	动态nat
10．取代netmask命0；可以使用 语句。
	prefix-length
```

# 无线网络技术

![1598432056499](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\1598432056499.png)

```
在Cisco的整合无线方案中，分离-MAC结构是指什么？
	分离-MAC结构允许802．Il协议包的分离，就是分开处理CiscoLWAPP的、负责处理办议中实时部分的AP，以及任何对时间不敏感的项目(item)的WLAN控制器。
&IEEE802．Ilh规范对IEEE802．11a添加了哪两种扩展？
	发射功率控制和动态频率选择
哪一个IEEE委员会得到了WPA的支持，且被称为WPA2？
	802.11i
IEEE802.a基本标准有多少个非重叠的信道？
	12个
```

# IPV 6

### ipv6的优点

```
	IPv6不仅能提供大量的地址,而且还有许多其他的特性内置在这个版本的IP中 
	ipv6包中的报头排列成64位,使得处理速度大大加快,与IPv4相比,IPv6的查 找速度几乎等于光速 
	极大地提高了路由的效率和可伸缩性,因为可以极为有效地对地址进行聚合IP诵 还允许主机和网络有多个地址,这对于企业网络的可用性来说极为重要 
	在IPv6中 ,不会出现上述的广播风暴,因为 IPv6用 组播代替了广播。还有另外两 种类型的通信:单播(与 IP诅 中的完全一样)和任播(一种新的类型)。任播通信允许同一个地 址被放置到多台设备上,当路由器接收到目的地址为任播地址的数据包时,就将它路由到离它 最近的、共享同一个地址的主机上

```

### ipv6的简化表示

```
2001:0000:0000:0012:0000:0000:1234:56ba
化简为：
2001::0012:0：0：1234：56ba  //
组播地址：一个对多个  以FF开头
任播地址：因为可以将单个地址应用到多个接口上。也可以称它们为“一个对一组中的一个”地址 ,但称它们为“任播”更容易些
```

### ipv6的特殊地址

```
00：0：0：0：0：0等于：：。这是中0．0，0，0的等价物，当正在使用有状态的地
址配置时，典型情况下是主机的源地址
0：0：0：0：0：0：0:1等于：：1 这是中127．0．0.1口的等价物。
0：0：0：0：0：0：192，168．100.1这是在IPv6/IPv4混合网络环境中IPv4地址的表示式。
2000：：/3全球单播地址范围。
FCOO：：／7本地唯一单播地址范围。
FE80：：/10链路本地单播地址范围。
FF00：：/8组播地址范围。
3FFF：FFFF：：/32为示例和文档保留的地址。
2001：ODB8：：/32也是为示例和文档保留的地址
2002：：/16用于到IPv4的转换系统，这种结构允许IPv6包通过IPv4网络进行传输，而无需显式地配置隧道。
```

## 迁移技术

```
双栈技术
6to4隧道技术
NAT-PT
```

### 双栈技术

```
在IPv6迁移战略中，这是最常见的方式，因为它是最容易实现的，它允许设备使用IPv4或IPv6进行通信。使用双栈，可以对网络中的设备和应用程序依次进行升级。随着网络中越来越多的主机和设备得到升级，就会有更多的通信在IPv6上进行。最后，就可以全面升级到IPv6，到那时，就可以删除所有不再需要的IPv4协议栈。
```

### 6to4隧道技术

```
在现有的ipv4网络中传送ipv6流量
```

 理解链路本地地址

```
至在单位组织内部也不行。 理解本地唯一地址。 链路本地地就像IPv4专用地址，但它根本不可能被路由
```

唯一地址 

```
像链路本地地址，也像IPv4专用地址，它不能被 路由因特网中。然而，链路个地地址与本地唯一地址的不同之处是，本地唯一地址能够在 单位组织或公司内部进行路山。 
```

IPv6寻址

```
IPv6寻址与IPv4寻址不同。IPv6地址为128位长，有大得多的地 址空间，用十六进制数表示。它与IPv4不同，IPv4地址仅有32位长，而且用十进制数 表示。`  
```



### 章节练习

```
1.哪种类型的数据包只在单个接口上被寻址和传送？
	单播
2．哪一种类型的地址只被用得像IPv4中的常规公共可路由地址？
	全球组播
3．哪一种类型的地址意味着不会被路由？
	链路本地地址
4庵哪一种类型的地址并不意味着被路由到因特网，但仍然是全球唯一的？
	本地唯一地址
5，哪一种类型的地址意味着被传送到多个接口？
	组播
6．哪一种类型的地址能够识别多个接口，但数据包只传递到它所找到的第一个地址上？
	任播
7．哪一种路由协议使用组播地址FF02：：5？
	OSPF
8．IPv4的回送地址为127．0，0．1，IPv6的回送地址是什么？
	：：1
9，链路本地地址总是从哪里开始？
	FE80：：
本地唯一单播地址范围从哪里开始？
	FC00：：
```

### ipv6配置

```
详见P643
```

# 广域网

包交换：包交换是一种wan交换方法，允许和其他公司共享带宽和节省资金，适用于偶然突发性的传输，常见的额包交换由帧中继和x25

###  HDLC

 cisco路 由器上 的默认 串行 封装 类 型 

是 流行 的 ISO标 准 、面向位 的数据链路层协议 。它使用帧特性 、 效验和规定数据在同步串行数据链路 上的封装方法 。HDI'C是 一 种 用 于租用 线路 的点到点 协议 。没 有 任何 认 证 可 以用于 HDLC。 

每个厂商都有一种专用的 HDI￡ 封装方式的原因是 ,每个厂商解决 HDLC 和网络层协议通信时采用了不同的方法。如果厂商没有办法解决 HDI'C和 不 同的第 3层 协议通信的问题 ,那么 HDl￡ 只能携带一种协议 。这个标识协议属性的报头位于 HDLC 封装的数据字段中。 

show interface命令 验 证 HDLC足 否 启 用 。



封装类型

```
cisco
IEIF
```

### PPP 

 到点协议(Pont-to Poir1t Protocol,PPP)是 一个工业标准协议 。许多 HDI￡ 版本是专用的,而 PPP可 以用于不同厂商设各之间建立的点到点链路。它使用数据链路层 报头中的网络控制协议(Network Contro1ProtocoD字 段来标识 网络层协议 。允许认证和 多链路连接 ,并且可以在同步和异步链路上运行 。

既然 PPP可 以封装多种第 3层 被动路由协议 ,并且提供认证、动态寻址以及回叫功能,那么这些 都是放弃 HDLC而 选择 PPP作 为封装方案的理由。

PPP包 含 的 4个 主要 组件如下所示 

```
 EIA/TIA-232-C、V.24 V.35和串 行通信的物理层国际标准。
HDLC 在 串行链路上封装数据报 的方法 。
 LCP一种建立、配置 、维护和结束点到点连接的方法  NCP 一 种 建 立 和 配 置 不 同 网 络 层 协 议 的 方 法 。 NCP设 计 允 许 同 时 使 用 多 个 网 络 层 
```

 PPP数 据链路层协议。3种 数 据链 路层 协议是 

```
网络控 制协议 (Network Control I)rOtocol,NCP),用 于定义网络层协议 ;链路控制协 议(l冫ink Control ProtocoI,I'CP),用 于建 立 、配置、维护和结束点到点连接的方法;还 有 高级数据链路 控制 (HDl'C),用 于封装包的 MAC层 协 议。
```

ppp认证方法： pap chap（671）

### 帧中继

是一个提供高性能 的数据链路层和物理层的规范。帧中继是 X.25的 后继协议 ,但没有使用 X.25来 补偿物理 层出错(线路躁声)所使用的技术 。帧中继 比'点到点链路更划算 ,并且可以运行在 64KVs~ 45Mb/s(T3)之 间。帧中继提供动态分配带宽和拥塞控制特性 

 show frame relay lmi命令将显示本地路由器和帧中继交换机之问交换的 LMI流 量统 计

show frame pvc 将列出所有 已配置的 PVC和 DI'CI号 

### 章节练习

```
1.写出可以查看Cisco路由器串行接口so上的封装方法的命令。
		sh int s0
2，写出配置so为PPP封装的命令。
		conf t
		int s0
		encap ppp
3·写出配置Cisco路由器的用户名为todd、口令为cisco的命令。
		conf t
		username todd password cisco
4．写出在CiscoBRI接口上启用CHAP认证的命令（假定封装类型是PPP)。
		cong t
		int bri0
		ppp authentication chap
5．写出为两个串行接口so和sl配置DI,CI号的命令。so的DLCI号为16，sl的DL-CI号为17。
		conf t
		int s0
		frame interface-dlci 16
		int s1
		frame interface-dlci 17
6．写出使用点到点子接口配置远程办公室的命令。DLCI为16，IP地址为172，16，60，1／24。
		conf t
		int s0
		encap frame
		int s0.16 point-to-point
		ip addr 172.168.60.1 255.255.255.0
		frame interface-dlci 16
7·如果运行xDSL并需要认证，使用什么协议？
		pppoe
8．写出PPP专用的3个协议
		HDLC LCP NCP
9·写出在VPN通道中提供安全服务所需用到的协议组。
		IPSec
10．写出VPN的3种不同的分类。
远程访问vpn  站点到站点vpn  外部网路vpn
```

